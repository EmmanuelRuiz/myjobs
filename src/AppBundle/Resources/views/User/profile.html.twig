{% extends "AppBundle:Layouts:layoutprofiles.html.twig"%}
{% block javascripts %}
    {{parent()}}
    <script src="{{ asset('assets/js/custom/users.js') }}"></script>
{% endblock javascripts %}
{% block content %}
    <section class="profile-company-header">
        <div class="container ">
            <div class="row">
                <div class="col-lg-3">
                    {% if user.image == null%}
                        <img class="profile-picture-company pull-right" src="{{ asset('assets/images/company-logo.png') }}"/>
                    {% else %}
                        <img class="profile-picture-company pull-right" src="{{ asset('uploads/users/'~user.image) }}"/>
                    {% endif %}
                </div>
                <div class="col-lg-9 " id="user-card">
                    <h1>
                        {{ user.name }} {{ user.plastname}}
                        {% if app.user.id == user.id %}
                        <div class="btn-group">
                            <a href="{{ path('user_edit') }}" class="btn btn-default btn-xs" type="button"  aria-haspopup="true" aria-expanded="false">
                                Editar perfil
                            </a>
                        </div>
                        {%endif%}
                        
                        {% if app.user.id != user.id %}
                            <div class="btn-group">
                                <button class="btn btn-xs btn-success btn-follow {% if app.user|following(user) == true%} hidden {% endif %}" data-followed="{{ user.id }}">
                                    <span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span>
                                    Seguir
                                </button>

                                <button class="btn btn-xs btn-default btn-unfollow {% if app.user|following(user) == false %} hidden {% endif %}" data-followed="{{ user.id }}">
                                    <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                                    Dejar de seguir
                                </button>
                            </div>      
                        {% endif %}
                    </h1>
                    
                    



                    <h5><b>Descripci√≥n</b></h5>

                    <p>{{user.biography}}</p>

                    <div class="row">
                        {% set user_stats = user.id |user_stats%}
                        <div class="following-data">
                            <a href="{{ path('following_users', {'email':user.email})}}">
                                <i class="fa fa-user-plus fa-2x" aria-hidden="true"></i>
                                <span class="number-stat">{{user_stats.following}}</span>
                            </a>
                        </div>

                        <div class="following-data">
                            <a href="{{ path('followed_users', {'email':user.email})}}">
                                <i class="fa fa-user-circle fa-2x" aria-hidden="true"></i>
                                <span class="number-stat">{{user_stats.followers}}</span>
                            </a>
                        </div>

                        <div class="following-data">
                            <a href="#">
                                <i class="fa fa-commenting fa-2x" aria-hidden="true"></i>
                                <span class="number-stat">{{user_stats.opinions}}</span>
                            </a>
                        </div>
                        <div class="following-data">
                            <a href="{{ path('user_likes', {'email':user.email})}}">
                                <i class="fa fa-heart fa-2x" aria-hidden="true"></i>
                                <span class="number-stat">{{user_stats.likes}}</span>
                            </a>
                        </div>
                        
                    </div>

                </div>
            </div>
        </div>
        <hr />
        <!-- /.container --> 
    </section>

    {# con esto obtenemos el del usuario app.user.name #}
    <section class="opinions-section">
        <div class="container">
            <div class="col-lg-12">
                {%for message in app.session.flashbag().get('status')%}
                    <div class="alert alert-success">{{message}}</div>
                {%endfor%}

                {%for message in app.session.flashbag().get('msg')%}
                    <div class="alert alert-success">{{message}}</div>
                {%endfor%}
            </div>
            <div class="col-lg-8">

                {% if user_stats.opinions == 0%}
                    <h2 class="text-muted">{{user.name}} aun no hay realizado ninguna opinion</h2>

                {% else %}
                    <h1 class="page-header">Opiniones</h1>
                {% endif %}
                {% for opinions in pagination %}
                    <div class="media">
                        <div class="media-left ">
                            <a href="#">
                                <div class="avatar">
                                    {% if opinions.user.image == null%}
                                        <img class="user-logo-opinion" src="{{ asset('assets/images/default.jpg') }}"/>
                                    {% else %}
                                        <img class="user-logo-opinion" src="{{ asset('uploads/users/'~opinions.user.image) }}"/>
                                    {% endif %}
                                </div>
                            </a>
                        </div>

                        <div class="media-body">
                            <h5 class="media-heading"><a href="#">{{opinions.user.name}} {{opinions.user.plastname}}</a>
                                {% if app.user == null %}

                                {% else %}
                                    {% if opinions.user.id == app.user.id %}
                                        <div class="btn-group pull-right">
                                            <button class="btn btn-link btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="caret caret-opinioncomment"></span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="btn-delete-pub" data-id="{{ opinions.id }}">Eliminar</a></li>

                                            </ul>
                                        </div> 
                                    {% endif %}
                                {% endif%}
                                <span class="pull-right text-muted">{{opinions.createdAt|long_time}}</span>

                            </h5>
                            <p>{{opinions.generalcomment}}</p>

                            <div class="like">
                                {% if app.user == null%}

                                {% else %}
                                    <i data-id="{{opinions.id}}" class="
                                          {% if app.user|liked(opinions) == true%}
                                              hidden
                                          {% endif %}
                                          btn-like fa fa-heart" 
                                          aria-hidden="true" 
                                          data-toggle="tooltip" 
                                          data-placement="left" 
                                          title="Me gusta">
                                    </i>
                                {% endif %}

                                {% if app.user == null%}

                                {% else %}    
                                    <i data-id="{{opinions.id}}" class="
                                          {% if app.user|liked(opinions) == false%}
                                              hidden
                                          {% endif %}
                                          btn-unlike active fa fa-heart" 
                                          aria-hidden="true" 
                                          data-toggle="tooltip" 
                                          data-placement="left" 
                                          title="Ya no me gusta">
                                    </i>
                                {% endif %}
                            </div><hr>

                            <div class="media">


                                {% for comments in comments%}
                                    {% if comments.opinion.id == opinions.id %}
                                        {% if comments.status != 'invalid'%}
                                            <div class="media-left">
                                                <div class="avatar">
                                                    {% if comments.user.image == null%}
                                                        <img class="user-logo-opinion-comment" src="{{ asset('assets/images/default.jpg') }}"/>
                                                    {% else %}
                                                        <img class="user-logo-opinion-comment" src="{{ asset('uploads/users/'~comments.user.image) }}"/>
                                                    {% endif %}
                                                </div>
                                            </div>

                                            <div class="media-body">

                                                <h5 class="media-heading"><a href="#">{{comments.user.name}} {{comments.user.plastname}}</a>
                                                    {% if app.user != null %}
                                                        {% if comments.user.id == app.user.id %}
                                                            <div class="btn-group pull-right">
                                                                <button class="btn btn-link btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                    <span class="caret caret-opinioncomment"></span>
                                                                </button>
                                                                <ul class="dropdown-menu">
                                                                    <li><a class="btn-delete-pub" data-id="{{ comments.id }}">Eliminar</a></li>

                                                                </ul>
                                                            </div> 
                                                        {% endif %}
                                                    {% endif%}
                                                    <span class="pull-right text-muted">{{comments.createdAt|long_time}}</span>

                                                </h5>


                                                <p>{{ comments.body }}</p>

                                                {% if comments.image != null%}
                                                    <img class="center-block" width="200" src="{{ asset('uploads/comments/images/'~comments.image) }}"/>
                                                {% endif %}



                                            </div>
                                            <hr>   
                                            <div class="clearfix"></div>
                                        {% endif %}
                                    {% else %}

                                    {% endif %}

                                {% endfor %}
                                {% if app.user != null%}   
                                    <form method="post" enctype="multipart/form-data" class="comment-form" action="{{ path('comment_crate_user', {'id':user.id, 'opinion_id':opinions.id}) }}" >
                                        <div class="form-group">
                                            <label for="nameInput">Agregar comentario</label>
                                            <textarea type="text" class="form-control" id="nameInput" placeholder="Escribe tu comentario..." name="comment" rows="2" cols="80"></textarea>
                                            <br />
                                            <button type="submit" class="btn btn-default pull-right">Comentar</button> 

                                            <label for="file" class="pull-right label-img"><i class="fa fa-picture-o" aria-hidden="true"></i></label>
                                            <input id="file" name="image" type="file" >
                                        </div>
                                    </form>
                                {% endif %}        
                            </div>
                        </div>   
                    </div>                  
                    <hr />
                {% endfor %}
            </div>
        </div>
    </section>
    <div class="pagination">
        {{ knp_pagination_render(pagination) }}
    </div>
</div>
{% endblock %}
